# Test nested remote workflow fetching and resolution

# Test direct remote workflow execution
exec maru2 --from $HTTP_BASE_URL/simple.yaml hello
stdout 'Hello from remote!'
stderr 'echo.*Hello from remote'

# Test workflow that uses another remote workflow
exec maru2 --from $HTTP_BASE_URL/with-uses.yaml main
stdout 'Starting main task'
stdout 'Hello from remote!'
stderr 'echo.*Starting main task'
stderr 'echo.*Hello from remote'

# Test nested dependencies with file: scheme
exec maru2 --from $HTTP_BASE_URL/nested.yaml nested
stdout 'Nested task'
stdout 'Deep nested task'
stderr 'echo.*Nested task'
stderr 'echo.*Deep nested task'

# Test fetch-all with nested dependencies
exec maru2 --fetch-all --from $HTTP_BASE_URL/nested.yaml
! stderr .
! stdout .

# Test fetch-all with nested dependencies and execution
exec maru2 --fetch-all --from $HTTP_BASE_URL/nested.yaml nested
stdout 'Nested task'
stdout 'Deep nested task'
stderr 'echo.*Nested task'
stderr 'echo.*Deep nested task'

-- tasks.yaml --
schema-version: v1
tasks:
  local:
    steps:
      - run: echo "Local task"
